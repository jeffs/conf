# theme = 'ayu_dark'
# theme = 'base16_default_dark'
theme = 'jeffs_base16_terminal'
# theme = 'aurara'

# I use the mouse for Wezterm, and Helix gets in the way by default, like
# by stealing Command+click (which I use to drag Wezterm windows). Wezterm
# automatically translates scroll events to move the cursor up or down several
# lines at a time when Helix is active, which is nice. Gesture remapping in
# Helix is pending <https://github.com/helix-editor/helix/pull/9469>.
#
# WezTerm supports gesture remapping already. In theory, you can bypass the
# application by holding the Shift key; so, Shift+click moves the window even
# if Helix mouse support has not disabled. In practice, Helix seems to get the
# pointerdown event, just not the pointerup. When you click, the cursor moves;
# and when you release the keys  (regardless of order), you're suddenly in
# the middle of highlighting text in Helix. Possible workarounds include using
# WeztTerm's tab bar to move the window, or disabling mouse support in Helix.
# See also <https://wezterm.org/config/mouse.html>.
#
# Update: The mouse event weirdness isn't only in Helix. I'm now running
# Nushell in Zellij (which I wasn't before) and seeing the same inadvertent
# text selection.
editor.mouse = false

editor.true-color = true

# [Recommended settings](https://docs.helix-editor.com/editor.html):
# Show warnings and errors on the cursorline inline.
editor.end-of-line-diagnostics = "hint"
editor.inline-diagnostics.cursor-line = "warning"

# Don't auto-insert closing ``` ` ```. It plays hell with Markdown code blocks,
# including those in Rust doc comments. Sadly:
#
# * We have to do this separately for each language, otherwise the language
#   config overrides it. It _seems_ like setting editor.auto-pairs should
#   work unless language.auto-pairs has been set explicitly by the user, but
#   it doesn't. See also:
#   <https://docs.helix-editor.com/editor.html#editorauto-pairs-section>
# * There doesn't seem to be any way to modify the default. You have
#   to explicitly restate the entire mappin, even when that mapping is
#   language-specific.
#
# editor.auto-pairs = { '(' = ')', '{' = '}', '[' = ']', '"' = '"', '<' = '>' }

# Remove "line-numbers" to toggle them. As with auto-pairs, there doesn't seem
# to be any way to add or remove elements: All you can do is replace the
# entire collection explicitly.
#
# TODO: Bind a key to (1) run a script (Steel?) that toggles the commented code
#  here and (2) calls `:config-reload`.
#
# editor.gutters = ["diff", "diagnostics", "line-numbers", "spacer"]
# editor.gutters = ["diff", "diagnostics", "spacer"]

[editor.soft-wrap]
enable = true
# Indenting wrapped lines eases visual parsing of Markdown lists. I haven't
# figured out how to set language-specific wrap indicators in Helix yet.
wrap-indicator = '  â†ª '

# Show the tab bar when multiple buffers are open.
# bufferline = "multiple"

[editor.cursor-shape]
insert = 'bar'
normal = 'block'
select = 'underline'

[keys.insert]
C-e = ['normal_mode']
C-t = ['normal_mode', ':write']
C-space = 'completion'

[keys.normal]
'{' = 'goto_prev_paragraph'
'}' = 'goto_next_paragraph'
C-e = 'scroll_down'
C-j = ':pipe-to tmux-send'
C-t = ':write'
C-y = 'scroll_up'

# NB: Relies on my Helix fork for goto_file_cwd.
g = { q = ':reflow', F = 'goto_file_cwd' }
# g = { q = ':reflow' }

left = ':buffer-previous'
right = ':buffer-next'

';' = 'command_mode'
':' = 'collapse_selection'

# <https://docs.helix-editor.com/command-line.html?highlight=expand#expansions>
#
# Print the current line's git blame information to the statusline.
space.B = ":echo %sh{git blame -L %{cursor_line},+1 %{buffer_name}}"
space.L = ":sh git log %{buffer_name}"

[keys.normal.C-f]
c = ':buffer-close'
d = ['save_selection', ":append-output echo ')'", 'jump_backward', ":insert-output echo 'dbg!('", 'jump_forward', 'jump_backward']
f = ':format'
i = ':toggle lsp.display-inlay-hints'
n = ':toggle soft-wrap.enable'
q = ':quit'
r = ':reload-all'
w = ':write'
z = ':write-quit'
C-c = ':config-reload'
C-f = 'page_down'

# Running a sequence of :set or :toggle commands is currently broken. See:
# <https://github.com/helix-editor/helix/issues/13187>
# 
# Worked around by forking Helix and applying Kyle Hutchens' PR:
# https://github.com/helix-editor/helix/pull/14629 # @khutchens
e = [":toggle end-of-line-diagnostics hint disable", ":toggle inline-diagnostics.cursor-line warning disable"]

[keys.select.C-f]
c = ':buffer-close'
d = ['save_selection', ":append-output echo ')'", 'jump_backward', ":insert-output echo 'dbg!('", 'jump_forward', 'jump_backward']
i = ':toggle lsp.display-inlay-hints'
n = ':toggle soft-wrap.enable'
q = ':quit'
w = ':write'
z = ':write-quit'
C-f = 'page_down'

[keys.select]
';' = 'command_mode'
':' = 'collapse_selection'
'{' = 'goto_prev_paragraph'
'}' = 'goto_next_paragraph'

# CWD-relative analogs of <c-w>f/F.
# NB: Relies on my Helix fork for goto_file_cwd.
[keys.normal.C-w]
g = "goto_file_cwd_hsplit"   # horizontal split variant
G = "goto_file_cwd_vsplit"   # vertical split variant
